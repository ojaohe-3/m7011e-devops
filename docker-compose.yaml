
services:

  db:
    image: postgres
    restart: always
    shm_size: 128mb
    environment:
      POSTGRES_PASSWORD: example
    ports:
      - 5432:5432
    volumes:
      - postgres-data:/var/lib/postgresql/data

  adminer:
    image: adminer
    restart: always
    ports:
      - 8089:8080
  reposilite:
      image: dzikoysk/reposilite:3.2.0
      ports:
        - 9000:8080
      env_file:
        - .env
      environment:
        - JAVA_OPTS=-Xmx256M
        - REPOSILITE_OPTS=--port 8080
      volumes:
        - reposilite-data:/app/data
      restart: unless-stopped
      stdin_open: true
      tty: true

  redis:
    image: docker.io/bitnami/redis:7.4
    environment:
      # ALLOW_EMPTY_PASSWORD is recommended only for development.
      - ALLOW_EMPTY_PASSWORD=yes
      - REDIS_DISABLE_COMMANDS=FLUSHDB,FLUSHALL
    ports:
      - '6379:6379'
    volumes:
      - 'redis_data:/bitnami/redis/data'
  keycloak:
    image: quay.io/keycloak/keycloak:latest
    environment:
      KC_DB: postgres
      KC_DB_URL: jdbc:postgresql://db:5432/keycloak
      KC_DB_USERNAME: keycloak
      KC_DB_PASSWORD: secret
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
      KC_HOSTNAME: localhost
    ports:
      - "8090:8080"
    command: start-dev
    depends_on:
      db:
        condition: service_healthy

volumes:
  postgres-data:
  reposilite-data: {}
  redis_data:
    driver: local